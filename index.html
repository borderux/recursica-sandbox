<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Recursica Sandbox</title>
    <script>
      // Check if the current path matches a Storybook build folder
      function checkForStorybookBuild() {
        const path = window.location.pathname;
        const pathSegments = path.split('/').filter(segment => segment);

        // If we're at the root, serve the main app (do nothing, let it load)
        if (pathSegments.length === 0) {
          return;
        }

        // For GitHub Pages, the first segment might be the repository name
        // Check if we're at the root of the site (just the repo name)
        if (
          pathSegments.length === 1 &&
          pathSegments[0] === 'recursica-sandbox'
        ) {
          return; // This is the root, serve the main app
        }

        // Get the actual path after the repository name
        let actualPathSegments = pathSegments;
        if (pathSegments[0] === 'recursica-sandbox') {
          actualPathSegments = pathSegments.slice(1);
        }

        // If no actual path segments after removing repo name, serve main app
        if (actualPathSegments.length === 0) {
          return;
        }

        // Check if the first segment matches a build folder
        const buildFolder = actualPathSegments[0];
        const buildPath = `/recursica-sandbox/builds/${buildFolder}/index.html`;

        // Try to fetch the build's index.html to see if it exists
        fetch(buildPath, { method: 'HEAD' })
          .then(response => {
            if (response.ok) {
              // Build exists, redirect to it
              window.location.href = buildPath;
            }
            // If build doesn't exist, stay on the main app
          })
          .catch(() => {
            // Error occurred, stay on the main app
          });
      }

      // Run the check when the page loads
      checkForStorybookBuild();
    </script>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>
